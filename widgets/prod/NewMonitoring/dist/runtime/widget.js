System.register(["jimu-core","esri/layers/FeatureLayer","esri/rest/support/Query"],(function(e,t){var r={},n={},u={};return{setters:[function(e){r.React=e.React,r.getAppStore=e.getAppStore},function(e){n.default=e.default},function(e){u.default=e.default}],execute:function(){e((()=>{var e={9818:e=>{"use strict";e.exports=n},7902:e=>{"use strict";e.exports=u},8891:e=>{"use strict";e.exports=r}},t={};function a(r){var n=t[r];if(void 0!==n)return n.exports;var u=t[r]={exports:{}};return e[r](u,u.exports,a),u.exports}a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="";var o={};return a.p=window.jimuConfig.baseUrl,(()=>{"use strict";a.r(o),a.d(o,{__set_webpack_public_path__:()=>i,default:()=>u});var e=a(8891),t=a(9818),r=a(7902),n=function(e,t,r,n){return new(r||(r=Promise))((function(u,a){function o(e){try{s(n.next(e))}catch(e){a(e)}}function i(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?u(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,i)}s((n=n.apply(e,t||[])).next())}))};function u(u){const a=e.React.useRef(null),o=e.React.useRef(!1),i=new t.default({url:"https://gis.uzspace.uz/uzspacesrvr/rest/services/Hosted/NewDataStruct/FeatureServer/0"}),[s,c]=e.React.useState(!1);return e.React.useEffect((()=>{const t=setTimeout((()=>n(this,void 0,void 0,(function*(){c(!1);const t=new Date,n=(0,e.getAppStore)().getState();var u={portalname:n.appInfo.name,username:n.user.username,fullname:n.user.fullName,datefinstr:t.toLocaleDateString("ru").split(".").reverse().join("."),datefinint:Math.round(t.getTime()/1e3),llin:Math.round(t.getTime()/1e3),lout:Math.round(t.getTime()/1e3),dur:0,portalid:n.appInfo.id,portcreat:n.appInfo.owner};const a=new r.default({where:`portalname = '${n.appInfo.name}' AND username = '${n.user.username}' AND datefinstr = '${t.toLocaleDateString("ru").split(".").reverse().join(".")}'`,outFields:["*"]}),s=yield i.queryFeatures(a);if(s.features.length)o.current=s.features[0].attributes,o.current.llin=Math.round(t.getTime()/1e3),yield i.applyEdits({updateFeatures:[{attributes:o.current}]});else{const e=yield i.applyEdits({addFeatures:[{attributes:u}]});o.current=Object.assign(Object.assign({},u),{objectid:e.addFeatureResults[0].objectId})}c(!0)}))),1e3);return()=>{clearTimeout(t)}}),[]),e.React.useEffect((()=>{if(!s||!o.current)return;let e=Math.round(Date.now()/1e3);const t=()=>n(this,void 0,void 0,(function*(){const t=Math.round(Date.now()/1e3);o.current.dur+=t-e,e=t,o.current.lout=t,yield i.applyEdits({updateFeatures:[{attributes:o.current}]})})),r=()=>{document.hidden?(t(),a.current&&(clearInterval(a.current),a.current=null)):(e=Math.round(Date.now()/1e3),a.current=window.setInterval(t,5e3))};return a.current=window.setInterval(t,5e3),document.addEventListener("visibilitychange",r),()=>{document.removeEventListener("visibilitychange",r),a.current&&(clearInterval(a.current),a.current=null)}}),[s]),e.React.createElement("div",{className:"mainArea"})}function i(e){a.p=e}})(),o})())}}}));